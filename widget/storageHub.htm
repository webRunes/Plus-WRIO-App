<script>
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
require("cross-storage").CrossStorageHub.init([{origin:/.*/,allow:["get","set","del"]}]);

},{"cross-storage":4}],2:[function(require,module,exports){
!function(e){function t(e,r){r=r||{},this._id=t._generateUUID(),this._promise=r.promise||Promise,this._frameId=r.frameId||"CrossStorageClient-"+this._id,this._origin=t._getOrigin(e),this._requests={},this._connected=!1,this._closed=!1,this._count=0,this._timeout=r.timeout||3e3,this._listener=null,this._installListener();var o;r.frameId&&(o=document.getElementById(r.frameId)),o&&this._poll(),o=o||this._createFrame(e),this._hub=o.contentWindow}t.frameStyle={display:"none",position:"absolute",top:"-999px",left:"-999px"},t._getOrigin=function(e){var t,r,o;return t=document.createElement("a"),t.href=e,t.host||(t=window.location),r=t.protocol&&":"!==t.protocol?t.protocol:window.location.protocol,o=r+"//"+t.host,o=o.replace(/:80$|:443$/,"")},t._generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,r="x"==e?t:3&t|8;return r.toString(16)})},t.prototype.onConnect=function(){var e=this;return this._connected?this._promise.resolve():this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(this._requests.connect||(this._requests.connect=[]),new this._promise(function(t,r){var o=setTimeout(function(){r(new Error("CrossStorageClient could not connect"))},e._timeout);e._requests.connect.push(function(e){return clearTimeout(o),e?r(e):void t()})}))},t.prototype.set=function(e,t,r){return this._request("set",{key:e,value:t,ttl:r})},t.prototype.get=function(e){var t=Array.prototype.slice.call(arguments);return this._request("get",{keys:t})},t.prototype.del=function(){var e=Array.prototype.slice.call(arguments);return this._request("del",{keys:e})},t.prototype.clear=function(){return this._request("clear")},t.prototype.getKeys=function(){return this._request("getKeys")},t.prototype.close=function(){var e=document.getElementById(this._frameId);e&&e.parentNode.removeChild(e),window.removeEventListener?window.removeEventListener("message",this._listener,!1):window.detachEvent("onmessage",this._listener),this._connected=!1,this._closed=!0},t.prototype._installListener=function(){var e=this;this._listener=function(t){var r,o,n;if(!e._closed&&t.origin===e._origin)if("cross-storage:unavailable"!==t.data){if(-1!==t.data.indexOf("cross-storage:")&&!e._connected){if(e._connected=!0,!e._requests.connect)return;for(r=0;r<e._requests.connect.length;r++)e._requests.connect[r](o);delete e._requests.connect}if("cross-storage:ready"!==t.data){try{n=JSON.parse(t.data)}catch(s){return}n.id&&e._requests[n.id]&&e._requests[n.id](n.error,n.result)}}else{if(e._closed||e.close(),!e._requests.connect)return;for(o=new Error("Closing client. Could not access localStorage in hub."),r=0;r<e._requests.connect.length;r++)e._requests.connect[r](o)}},window.addEventListener?window.addEventListener("message",this._listener,!1):window.attachEvent("onmessage",this._listener)},t.prototype._poll=function(){var e,t;e=this,t=setInterval(function(){return e._connected?clearInterval(t):void(e._hub&&e._hub.postMessage("cross-storage:poll",e._origin))},1e3)},t.prototype._createFrame=function(e){var r,o;r=window.document.createElement("iframe"),r.id=this._frameId;for(o in t.frameStyle)t.frameStyle.hasOwnProperty(o)&&(r.style[o]=t.frameStyle[o]);return window.document.body.appendChild(r),r.src=e,r},t.prototype._request=function(e,t){var r,o;return this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(o=this,o._count++,r={id:this._id+":"+o._count,method:"cross-storage:"+e,params:t},new this._promise(function(e,t){var n,s;n=setTimeout(function(){o._requests[r.id]&&(delete o._requests[r.id],t(new Error("Timeout: could not perform "+r.method)))},o._timeout),o._requests[r.id]=function(r,o){return clearTimeout(n),r?t(new Error(r)):void e(o)},Array.prototype.toJSON&&(s=Array.prototype.toJSON,Array.prototype.toJSON=null),o._hub.postMessage(JSON.stringify(r),o._origin),s&&(Array.prototype.toJSON=s)}))},"undefined"!=typeof module&&module.exports?module.exports=t:"undefined"!=typeof exports?exports.CrossStorageClient=t:"function"==typeof define&&define.amd?define("CrossStorageClient",[],function(){return t}):e.CrossStorageClient=t}(this);

},{}],3:[function(require,module,exports){
!function(e){var r={};r.init=function(e){var t=!0;try{window.localStorage||(t=!1)}catch(n){t=!1}if(!t)try{return window.parent.postMessage("cross-storage:unavailable","*")}catch(n){return}r._permissions=e||[],r._installListener(),window.parent.postMessage("cross-storage:ready","*")},r._installListener=function(){var e=r._listener;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)},r._listener=function(e){var t,n,o,s,i;if("cross-storage:poll"===e.data)return window.parent.postMessage("cross-storage:ready",e.origin);if("cross-storage:ready"!==e.data&&(t=JSON.parse(e.data),n=t.method.split("cross-storage:")[1])){if(r._permitted(e.origin,n))try{s=r["_"+n](t.params)}catch(a){o=a.message}else o="Invalid permissions for "+n;i=JSON.stringify({id:t.id,error:o,result:s}),window.parent.postMessage(i,e.origin)}},r._permitted=function(e,t){var n,o,s,i;if(n=["get","set","del","clear","getKeys"],!r._inArray(t,n))return!1;for(o=0;o<r._permissions.length;o++)if(s=r._permissions[o],s.origin instanceof RegExp&&s.allow instanceof Array&&(i=s.origin.test(e),i&&r._inArray(t,s.allow)))return!0;return!1},r._set=function(e){var t,n;if(t=e.ttl,t&&parseInt(t,10)!==t)throw new Error("ttl must be a number");n={value:e.value},t&&(n.expire=r._now()+t),window.localStorage.setItem(e.key,JSON.stringify(n))},r._get=function(e){var t,n,o,s,i;for(t=window.localStorage,n=[],o=0;o<e.keys.length;o++)i=e.keys[o],s=JSON.parse(t.getItem(i)),null===s?n.push(null):s.expire&&s.expire<r._now()?(t.removeItem(i),n.push(null)):n.push(s.value);return n.length>1?n:n[0]},r._del=function(e){for(var r=0;r<e.keys.length;r++)window.localStorage.removeItem(e.keys[r])},r._clear=function(){window.localStorage.clear()},r._getKeys=function(e){var r,t,n;for(n=[],t=window.localStorage.length,r=0;t>r;r++)n.push(window.localStorage.key(r));return n},r._inArray=function(e,r){for(var t=0;t<r.length;t++)if(e===r[t])return!0;return!1},r._now=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()},"undefined"!=typeof module&&module.exports?module.exports=r:"undefined"!=typeof exports?exports.CrossStorageHub=r:"function"==typeof define&&define.amd?define("CrossStorageHub",[],function(){return r}):e.CrossStorageHub=r}(this);

},{}],4:[function(require,module,exports){
module.exports={CrossStorageClient:require("./client.js"),CrossStorageHub:require("./hub.js")};

},{"./client.js":2,"./hub.js":3}]},{},[1]);
</script>
